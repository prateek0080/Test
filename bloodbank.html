<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blood Bank - Mediconnect</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
  <div class="form-container bloodbank-container">
    <h2><i class="fa-solid fa-droplet"></i> Blood Bank Services</h2>
    <p>Request blood or register as a donor to save lives</p>
    
    <div class="bloodbank-tabs">
      <button class="tab-button active" onclick="showTab('request')">
        <i class="fa-solid fa-hand-holding-medical"></i> Request Blood
      </button>
      <button class="tab-button" onclick="showTab('donate')">
        <i class="fa-solid fa-heart"></i> Donate Blood
      </button>
    </div>

    <!-- Blood Request Form -->
    <div id="requestTab" class="tab-content active">
      <form id="bloodRequestForm">
        <div class="form-group">
          <label for="patientName"><i class="fa-solid fa-user"></i> Patient Name</label>
          <input type="text" id="patientName" name="patientName" placeholder="Enter patient name" required>
        </div>
        <div class="form-group">
          <label for="bloodType"><i class="fa-solid fa-droplet"></i> Blood Type Needed</label>
          <select id="bloodType" name="bloodType" required>
            <option value="">-- Select Blood Type --</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
        </div>
        <div class="form-group">
          <label for="unitsNeeded"><i class="fa-solid fa-vial"></i> Units Needed</label>
          <input type="number" id="unitsNeeded" name="unitsNeeded" min="1" max="10" placeholder="Number of units" required>
        </div>
        <div class="form-group">
          <label for="urgency"><i class="fa-solid fa-clock"></i> Urgency Level</label>
          <select id="urgency" name="urgency" required>
            <option value="">-- Select Urgency --</option>
            <option value="Critical">Critical (Within 2 hours)</option>
            <option value="Urgent">Urgent (Within 6 hours)</option>
            <option value="Normal">Normal (Within 24 hours)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="hospital"><i class="fa-solid fa-hospital"></i> Hospital/Location</label>
          <input type="text" id="hospital" name="hospital" placeholder="Enter hospital name and address" required>
        </div>
        <div class="form-group">
          <label for="contactPhone"><i class="fa-solid fa-phone"></i> Contact Number</label>
          <input type="tel" id="contactPhone" name="contactPhone" placeholder="10-digit number" required pattern="[0-9]{10}">
        </div>
        <button type="submit" class="form-button bloodbank-request-button">
          <i class="fa-solid fa-paper-plane"></i> Submit Blood Request
        </button>
      </form>
    </div>

    <!-- Blood Donation Form -->
    <div id="donateTab" class="tab-content">
      <form id="bloodDonateForm">
        <div class="form-group">
          <label for="donorName"><i class="fa-solid fa-user"></i> Your Name</label>
          <input type="text" id="donorName" name="donorName" placeholder="Enter your full name" required>
        </div>
        <div class="form-group">
          <label for="donorBloodType"><i class="fa-solid fa-droplet"></i> Your Blood Type</label>
          <select id="donorBloodType" name="donorBloodType" required>
            <option value="">-- Select Your Blood Type --</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
        </div>
        <div class="form-group">
          <label for="donorAge"><i class="fa-solid fa-calendar"></i> Age</label>
          <input type="number" id="donorAge" name="donorAge" min="18" max="65" placeholder="Your age" required>
        </div>
        <div class="form-group">
          <label for="donorWeight"><i class="fa-solid fa-weight-scale"></i> Weight (kg)</label>
          <input type="number" id="donorWeight" name="donorWeight" min="50" placeholder="Your weight in kg" required>
        </div>
        <div class="form-group">
          <label for="lastDonation"><i class="fa-solid fa-calendar-days"></i> Last Donation Date</label>
          <input type="date" id="lastDonation" name="lastDonation">
          <small>Leave blank if first time donor</small>
        </div>
        <div class="form-group">
          <label for="donorPhone"><i class="fa-solid fa-phone"></i> Contact Number</label>
          <input type="tel" id="donorPhone" name="donorPhone" placeholder="10-digit number" required pattern="[0-9]{10}">
        </div>
        <div class="form-group">
          <label for="donorAddress"><i class="fa-solid fa-location-dot"></i> Address</label>
          <input type="text" id="donorAddress" name="donorAddress" placeholder="Your complete address" required>
        </div>
        <button type="submit" class="form-button bloodbank-donate-button">
          <i class="fa-solid fa-heart"></i> Register as Donor
        </button>
      </form>
    </div>

    <div class="info-box bloodbank-info-box" id="bloodbankConfirmation">
      <i class="fa-solid fa-check-circle"></i> <span id="confirmationMessage">Request submitted successfully!</span>
    </div>

    <div class="blood-info">
      <h3><i class="fa-solid fa-info-circle"></i> Blood Donation Guidelines</h3>
      <ul>
        <li>Must be 18-65 years old</li>
        <li>Minimum weight: 50 kg</li>
        <li>Wait 56 days between donations</li>
        <li>Be in good health</li>
        <li>Avoid alcohol 24 hours before donation</li>
      </ul>
    </div>
  </div>

  <script>
    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      if (tabName === 'request') {
        document.getElementById('requestTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'request\')"]').classList.add('active');
      } else {
        document.getElementById('donateTab').classList.add('active');
        document.querySelector('[onclick="showTab(\'donate\')"]').classList.add('active');
      }
    }

    // Blood Request Form Handler
    const bloodRequestForm = document.getElementById('bloodRequestForm');
    const bloodDonateForm = document.getElementById('bloodDonateForm');
    const confirmation = document.getElementById('bloodbankConfirmation');
    const confirmationMessage = document.getElementById('confirmationMessage');

    bloodRequestForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        type: 'request',
        patientName: bloodRequestForm.patientName.value,
        bloodType: bloodRequestForm.bloodType.value,
        unitsNeeded: bloodRequestForm.unitsNeeded.value,
        urgency: bloodRequestForm.urgency.value,
        hospital: bloodRequestForm.hospital.value,
        contactPhone: bloodRequestForm.contactPhone.value
      };

      try {
        const response = await fetch('/api/bloodbank', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        const data = await response.json();
        if (response.ok) {
          confirmationMessage.textContent = 'Blood request submitted! We will contact you with available donors.';
          confirmation.style.display = 'block';
          bloodRequestForm.reset();
        } else {
          alert('Error: ' + data.message);
        }
      } catch (err) {
        alert('Failed to submit request. Please check the server.');
      }
    });

    // Blood Donation Form Handler
    bloodDonateForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        type: 'donate',
        donorName: bloodDonateForm.donorName.value,
        donorBloodType: bloodDonateForm.donorBloodType.value,
        donorAge: bloodDonateForm.donorAge.value,
        donorWeight: bloodDonateForm.donorWeight.value,
        lastDonation: bloodDonateForm.lastDonation.value || null,
        donorPhone: bloodDonateForm.donorPhone.value,
        donorAddress: bloodDonateForm.donorAddress.value
      };

      try {
        const response = await fetch('/api/bloodbank', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        const data = await response.json();
        if (response.ok) {
          confirmationMessage.textContent = 'Thank you for registering as a blood donor! We will contact you when needed.';
          confirmation.style.display = 'block';
          bloodDonateForm.reset();
        } else {
          alert('Error: ' + data.message);
        }
      } catch (err) {
        alert('Failed to register. Please check the server.');
      }
    });
  </script>
</body>
</html>